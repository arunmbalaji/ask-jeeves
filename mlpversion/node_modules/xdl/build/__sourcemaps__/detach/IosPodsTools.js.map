{"version":3,"sources":["detach/IosPodsTools.js"],"names":["async","templatesDirectory","versionedReactNativePath","expoSubspecs","let","result","await","_concatTemplateFilesInDirectoryAsync","path","join","map","subspec","replace","_renderVersionedReactNativeDependenciesAsync","_renderVersionedReactNativePostinstallsAsync","directory","templateFilenames","glob","templateStrings","Promise","all","filename","templateString","fs","readFile","push","dependenciesConfigPath","options","dependencies","readAsync","type","isPodfile","noWarningsFlag","depsStrings","dependency","name","version","_renderPodDependenciesAsync","pathToTemplate","pathToOutput","moreSubstitutions","dirname","indentString","IOS_EXPONENT_CLIENT_VERSION","writeFile","renderExpoKitPodspecAsync","sdkVersion","reactNativePath","REACT_NATIVE_PATH","rnDependencyOptions","expoKitPath","EXPOKIT_PATH","expoKitTag","EXPOKIT_TAG","expoKitDependencyOptions","versionedRnPath","VERSIONED_REACT_NATIVE_PATH","rnExpoSubspecs","REACT_NATIVE_EXPO_SUBSPECS","versionedDependencies","versionedPostinstalls","podDependencies","substitutions","EXPONENT_CLIENT_DEPS","EXPOKIT_DEPENDENCY","_renderExpoKitDependency","PODFILE_UNVERSIONED_RN_DEPENDENCY","_renderUnversionedReactNativeDependency","PODFILE_UNVERSIONED_POSTINSTALL","_renderUnversionedPostinstall","PODFILE_DETACHED_POSTINSTALL","_renderDetachedPostinstall","PODFILE_DETACHED_SERVICE_POSTINSTALL","PODFILE_VERSIONED_RN_DEPENDENCIES","PODFILE_VERSIONED_POSTINSTALLS","PODFILE_TEST_TARGET","_renderTestTarget","_validatePodfileSubstitutions","key","hasOwnProperty","replacement","RegExp","renderPodfileAsync","validKeys","includes","Error","sdkMajorVersion","parseSdkMajorVersion","attributes","git","tag","branch","subspecs","_renderDependencyAttributes","_renderUnversionedReactDependency","_renderUnversionedYogaDependency","glogLibraryName","_renderUnversionedThirdPartyDependency","podName","podspecRelativePath","podspec","inhibit_warnings","attributesStrings","Object","keys","value","JSON","stringify","isServiceContext","podsRootSub","maybeDetachedServiceDef","podsToChangeDeployTarget","podsToChangeRB","pod"],"mappings":"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","file":"../../detach/IosPodsTools.js","sourcesContent":["// Copyright 2015-present 650 Industries. All rights reserved.\n\n'use strict';\n\nimport fs from 'fs-extra';\nimport glob from 'glob-promise';\nimport indentString from 'indent-string';\nimport JsonFile from '@expo/json-file';\nimport path from 'path';\n\nimport { parseSdkMajorVersion } from './ExponentTools';\n\nfunction _validatePodfileSubstitutions(substitutions) {\n  const validKeys = [\n    // a pod dependency on ExpoKit (can be local or remote)\n    'EXPOKIT_DEPENDENCY',\n    // local path to ExpoKit dependency\n    'EXPOKIT_PATH',\n    // tag to use for ExpoKit dependency\n    'EXPOKIT_TAG',\n    // the contents of dependencies.json enumerated as deps in podfile format\n    'EXPONENT_CLIENT_DEPS',\n    // postinstall for detached projects (defines EX_DETACHED among other things)\n    'PODFILE_DETACHED_POSTINSTALL',\n    // same as previous but also defines EX_DETACHED_SERVICE\n    'PODFILE_DETACHED_SERVICE_POSTINSTALL',\n    // ExponentIntegrationTests\n    'PODFILE_TEST_TARGET',\n    // unversioned react native pod dependency, probably at the path given in\n    // REACT_NATIVE_PATH, with a bunch of subspecs.\n    'PODFILE_UNVERSIONED_RN_DEPENDENCY',\n    // postinstall hook for unversioned deps\n    'PODFILE_UNVERSIONED_POSTINSTALL',\n    // versioned rn dependencies (paths to versioned-react-native directories)\n    // read from template files\n    'PODFILE_VERSIONED_RN_DEPENDENCIES',\n    // versioned rn postinstall hooks read from template files\n    'PODFILE_VERSIONED_POSTINSTALLS',\n    // list of generated Expo subspecs to include under a versioned react native dependency\n    'REACT_NATIVE_EXPO_SUBSPECS',\n    // path to use for the unversioned react native dependency\n    'REACT_NATIVE_PATH',\n    // name of the main build target, e.g. Exponent\n    'TARGET_NAME',\n    // path from Podfile to versioned-react-native\n    'VERSIONED_REACT_NATIVE_PATH',\n  ];\n\n  for (const key in substitutions) {\n    if (substitutions.hasOwnProperty(key)) {\n      if (!validKeys.includes(key)) {\n        throw new Error(`Unrecognized Podfile template key: ${key}`);\n      }\n    }\n  }\n  return true;\n}\n\nfunction _renderExpoKitDependency(options, sdkVersion) {\n  const sdkMajorVersion = parseSdkMajorVersion(sdkVersion);\n  let attributes;\n  if (options.expoKitPath) {\n    attributes = {\n      path: options.expoKitPath,\n    };\n  } else if (options.expoKitTag) {\n    attributes = {\n      git: 'http://github.com/expo/expo.git',\n      tag: options.expoKitTag,\n    };\n  } else {\n    attributes = {\n      git: 'http://github.com/expo/expo.git',\n      branch: 'master',\n    };\n  }\n\n  // GL subspec is available as of SDK 26\n  if (sdkMajorVersion < 26) {\n    attributes.subspecs = ['Core', 'CPP'];\n  } else {\n    attributes.subspecs = ['Core', 'CPP', 'GL'];\n  }\n\n  let dependency = `pod 'ExpoKit',\n${indentString(_renderDependencyAttributes(attributes), 2)}`;\n\n  return indentString(dependency, 2);\n}\n\n/**\n * @param sdkVersion if specified, indicates which sdkVersion this project uses\n *  as 'UNVERSIONED', e.g. if we are detaching a sdk15 project, we render\n *  an unversioned dependency pointing at RN#sdk-15.\n */\nfunction _renderUnversionedReactNativeDependency(options, sdkVersion) {\n  let sdkMajorVersion = parseSdkMajorVersion(sdkVersion);\n  if (sdkMajorVersion < 21) {\n    return indentString(\n      `\n${_renderUnversionedReactDependency(options, sdkVersion)}\n${_renderUnversionedYogaDependency(options, sdkVersion)}\n`,\n      2\n    );\n  } else {\n    const glogLibraryName = (sdkMajorVersion < 26)\n          ? 'GLog'\n          : 'glog';\n    return indentString(\n      `\n${_renderUnversionedReactDependency(options, sdkVersion)}\n${_renderUnversionedYogaDependency(options, sdkVersion)}\n${_renderUnversionedThirdPartyDependency(\n        'DoubleConversion',\n        path.join('third-party-podspecs', 'DoubleConversion.podspec'),\n        options\n      )}\n${_renderUnversionedThirdPartyDependency(\n        'Folly',\n        path.join('third-party-podspecs', 'Folly.podspec'),\n        options\n      )}\n${_renderUnversionedThirdPartyDependency(\n        glogLibraryName,\n        path.join('third-party-podspecs', `${glogLibraryName}.podspec`),\n        options\n      )}\n`,\n      2\n    );\n  }\n}\n\nfunction _renderUnversionedReactDependency(options, sdkVersion) {\n  let attributes;\n  if (options.reactNativePath) {\n    attributes = {\n      path: options.reactNativePath,\n    };\n  } else {\n    throw new Error(`Unsupported options for RN dependency: ${options}`);\n  }\n\n  attributes.subspecs = [\n    'Core',\n    'ART',\n    'RCTActionSheet',\n    'RCTAnimation',\n    'RCTCameraRoll',\n    'RCTGeolocation',\n    'RCTImage',\n    'RCTNetwork',\n    'RCTText',\n    'RCTVibration',\n    'RCTWebSocket',\n  ];\n\n  let sdkMajorVersion = parseSdkMajorVersion(sdkVersion);\n  if (!(sdkMajorVersion < 16)) {\n    attributes.subspecs.push('DevSupport');\n  }\n  if (!(sdkMajorVersion < 21)) {\n    attributes.subspecs.push('CxxBridge');\n  } else if (!(sdkMajorVersion < 18)) {\n    attributes.subspecs.push('BatchedBridge');\n  }\n\n  return `pod 'React',\n${indentString(_renderDependencyAttributes(attributes), 2)}`;\n}\n\nfunction _renderUnversionedYogaDependency(options, sdkVersion) {\n  let attributes;\n  let sdkMajorVersion = parseSdkMajorVersion(sdkVersion);\n  if (options.reactNativePath) {\n    attributes = {\n      path: path.join(\n        options.reactNativePath,\n        'ReactCommon',\n        sdkMajorVersion < 22 ? 'Yoga' : 'yoga'\n      ),\n    };\n  } else {\n    throw new Error(`Unsupported options for Yoga dependency: ${options}`);\n  }\n  return `pod '${sdkMajorVersion < 22 ? 'Yoga' : 'yoga'}',\n${indentString(_renderDependencyAttributes(attributes), 2)}`;\n}\n\nfunction _renderUnversionedThirdPartyDependency(podName, podspecRelativePath, options) {\n  let attributes;\n  if (options.reactNativePath) {\n    attributes = {\n      podspec: path.join(options.reactNativePath, podspecRelativePath),\n      inhibit_warnings: true,\n    };\n  } else {\n    throw new Error(`Unsupported options for ${podName} dependency: ${options}`);\n  }\n  return `pod '${podName}',\n${indentString(_renderDependencyAttributes(attributes), 2)}`;\n}\n\nfunction _renderDependencyAttributes(attributes) {\n  let attributesStrings = [];\n  for (let key of Object.keys(attributes)) {\n    let value = JSON.stringify(attributes[key], null, 2);\n    attributesStrings.push(`:${key} => ${value}`);\n  }\n  return attributesStrings.join(',\\n');\n}\n\nasync function _renderVersionedReactNativeDependenciesAsync(\n  templatesDirectory,\n  versionedReactNativePath,\n  expoSubspecs\n) {\n  let result = await _concatTemplateFilesInDirectoryAsync(\n    path.join(templatesDirectory, 'versioned-react-native', 'dependencies')\n  );\n  expoSubspecs = expoSubspecs.map(subspec => `'${subspec}'`).join(', ');\n  result = result.replace(/\\$\\{VERSIONED_REACT_NATIVE_PATH\\}/g, versionedReactNativePath);\n  result = result.replace(/\\$\\{REACT_NATIVE_EXPO_SUBSPECS\\}/g, expoSubspecs);\n  return result;\n}\n\nasync function _renderVersionedReactNativePostinstallsAsync(templatesDirectory) {\n  return _concatTemplateFilesInDirectoryAsync(\n    path.join(templatesDirectory, 'versioned-react-native', 'postinstalls')\n  );\n}\n\nasync function _concatTemplateFilesInDirectoryAsync(directory) {\n  let templateFilenames = await glob(path.join(directory, '*.rb'));\n  let templateStrings = [];\n  await Promise.all(\n    templateFilenames.map(async filename => {\n      let templateString = await fs.readFile(filename, 'utf8');\n      if (templateString) {\n        templateStrings.push(templateString);\n      }\n    })\n  );\n  return templateStrings.join('\\n');\n}\n\nfunction _renderDetachedPostinstall(sdkVersion, isServiceContext) {\n  let podsRootSub = '${PODS_ROOT}';\n  const maybeDetachedServiceDef = (isServiceContext)\n        ? `config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'EX_DETACHED_SERVICE=1'`\n        : '';\n  return `\n    if target.pod_name == 'ExpoKit'\n      target.native_target.build_configurations.each do |config|\n        config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] ||= ['$(inherited)']\n        config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'EX_DETACHED=1'\n        ${maybeDetachedServiceDef}\n        # needed for GoogleMaps 2.x\n        config.build_settings['FRAMEWORK_SEARCH_PATHS'] ||= []\n        config.build_settings['FRAMEWORK_SEARCH_PATHS'] << '${podsRootSub}/GoogleMaps/Base/Frameworks'\n        config.build_settings['FRAMEWORK_SEARCH_PATHS'] << '${podsRootSub}/GoogleMaps/Maps/Frameworks'\n      end\n    end\n`;\n}\n\nfunction _renderUnversionedPostinstall() {\n  // TODO: switch to `installer.pods_project.targets.each` in postinstall\n  // see: https://stackoverflow.com/questions/37160688/set-deployment-target-for-cocoapodss-pod\n  const podsToChangeDeployTarget = [\n    'Amplitude-iOS',\n    'Analytics',\n    'AppAuth',\n    'Branch',\n    'CocoaLumberjack',\n    'FBSDKCoreKit',\n    'FBSDKLoginKit',\n    'FBSDKShareKit',\n    'GPUImage',\n    'JKBigInteger2',\n  ];\n  const podsToChangeRB = `[${podsToChangeDeployTarget.map(pod => `'${pod}'`).join(',')}]`;\n  return `\n    if ${podsToChangeRB}.include? target.pod_name\n      target.native_target.build_configurations.each do |config|\n        config.build_settings['IPHONEOS_DEPLOYMENT_TARGET'] = '9.0'\n      end\n    end\n    # Build React Native with RCT_DEV enabled\n    next unless target.pod_name == 'React'\n    target.native_target.build_configurations.each do |config|\n      config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] ||= ['$(inherited)']\n      config.build_settings['GCC_PREPROCESSOR_DEFINITIONS'] << 'RCT_DEV=1'\n    end\n`;\n}\n\nfunction _renderTestTarget(reactNativePath) {\n  return `\n  target 'ExponentIntegrationTests' do\n    inherit! :search_paths\n  end\n`;\n}\n\nasync function _renderPodDependenciesAsync(dependenciesConfigPath, options) {\n  let dependencies = await new JsonFile(dependenciesConfigPath).readAsync();\n  const type = options.isPodfile ? 'pod' : 'ss.dependency';\n  const noWarningsFlag = options.isPodfile ? `, :inhibit_warnings => true` : '';\n  let depsStrings = dependencies.map(\n    dependency => `  ${type} '${dependency.name}', '${dependency.version}'${noWarningsFlag}`\n  );\n  return depsStrings.join('\\n');\n}\n\nasync function renderExpoKitPodspecAsync(pathToTemplate, pathToOutput, moreSubstitutions) {\n  let templatesDirectory = path.dirname(pathToTemplate);\n  let templateString = await fs.readFile(pathToTemplate, 'utf8');\n  let dependencies = await _renderPodDependenciesAsync(\n    path.join(templatesDirectory, 'dependencies.json'),\n    { isPodfile: false }\n  );\n  let result = templateString.replace(/\\$\\{IOS_EXPOKIT_DEPS\\}/g, indentString(dependencies, 2));\n  if (moreSubstitutions && moreSubstitutions.IOS_EXPONENT_CLIENT_VERSION) {\n    result = result.replace(\n      /\\$\\{IOS_EXPONENT_CLIENT_VERSION\\}/g,\n      moreSubstitutions.IOS_EXPONENT_CLIENT_VERSION\n    );\n  }\n\n  await fs.writeFile(pathToOutput, result);\n}\n\n/**\n *  @param pathToTemplate path to template Podfile\n *  @param pathToOutput path to render final Podfile\n *  @param moreSubstitutions dictionary of additional substitution keys and values to replace\n *         in the template, such as: TARGET_NAME, REACT_NATIVE_PATH\n */\nasync function renderPodfileAsync(\n  pathToTemplate,\n  pathToOutput,\n  moreSubstitutions,\n  sdkVersion = 'UNVERSIONED'\n) {\n  if (!moreSubstitutions) {\n    moreSubstitutions = {};\n  }\n  let templatesDirectory = path.dirname(pathToTemplate);\n  let templateString = await fs.readFile(pathToTemplate, 'utf8');\n\n  let reactNativePath = moreSubstitutions.REACT_NATIVE_PATH;\n  let rnDependencyOptions;\n  if (reactNativePath) {\n    rnDependencyOptions = { reactNativePath };\n  } else {\n    rnDependencyOptions = {};\n  }\n\n  const expoKitPath = moreSubstitutions.EXPOKIT_PATH;\n  const expoKitTag = moreSubstitutions.EXPOKIT_TAG;\n  let expoKitDependencyOptions = {};\n  if (expoKitPath) {\n    expoKitDependencyOptions = { expoKitPath };\n  } else if (expoKitTag) {\n    expoKitDependencyOptions = { expoKitTag };\n  }\n\n  let versionedRnPath = moreSubstitutions.VERSIONED_REACT_NATIVE_PATH;\n  if (!versionedRnPath) {\n    versionedRnPath = './versioned-react-native';\n  }\n  let rnExpoSubspecs = moreSubstitutions.REACT_NATIVE_EXPO_SUBSPECS;\n  if (!rnExpoSubspecs) {\n    rnExpoSubspecs = ['Expo'];\n  }\n\n  let versionedDependencies = await _renderVersionedReactNativeDependenciesAsync(\n    templatesDirectory,\n    versionedRnPath,\n    rnExpoSubspecs\n  );\n  let versionedPostinstalls = await _renderVersionedReactNativePostinstallsAsync(\n    templatesDirectory\n  );\n  let podDependencies = await _renderPodDependenciesAsync(\n    path.join(templatesDirectory, 'dependencies.json'),\n    { isPodfile: true }\n  );\n\n  let substitutions = {\n    EXPONENT_CLIENT_DEPS: podDependencies,\n    EXPOKIT_DEPENDENCY: _renderExpoKitDependency(expoKitDependencyOptions, sdkVersion),\n    PODFILE_UNVERSIONED_RN_DEPENDENCY: _renderUnversionedReactNativeDependency(\n      rnDependencyOptions,\n      sdkVersion\n    ),\n    PODFILE_UNVERSIONED_POSTINSTALL: _renderUnversionedPostinstall(),\n    PODFILE_DETACHED_POSTINSTALL: _renderDetachedPostinstall(sdkVersion, false),\n    PODFILE_DETACHED_SERVICE_POSTINSTALL: _renderDetachedPostinstall(sdkVersion, true),\n    PODFILE_VERSIONED_RN_DEPENDENCIES: versionedDependencies,\n    PODFILE_VERSIONED_POSTINSTALLS: versionedPostinstalls,\n    PODFILE_TEST_TARGET: _renderTestTarget(reactNativePath),\n    ...moreSubstitutions,\n  };\n  _validatePodfileSubstitutions(substitutions);\n\n  let result = templateString;\n  for (let key in substitutions) {\n    if (substitutions.hasOwnProperty(key)) {\n      let replacement = substitutions[key];\n      result = result.replace(new RegExp(`\\\\\\$\\\\\\{${key}\\\\\\}`, 'g'), replacement);\n    }\n  }\n\n  await fs.writeFile(pathToOutput, result);\n}\n\nexport { renderExpoKitPodspecAsync, renderPodfileAsync };\n"],"sourceRoot":"/xdl/src"}