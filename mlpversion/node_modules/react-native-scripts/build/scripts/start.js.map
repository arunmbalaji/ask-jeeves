{"version":3,"sources":["start.js"],"names":["readPackagerInfoAsync","process","cwd","settings","constructManifestUrlAsync","address","emulatorHelp","platform","bold","generate","qrCode","underline","cyan","printUsage","printServerInfo","key","CTRL_C","CTRL_D","emit","withTimestamp","openProjectAsync","success","error","red","message","hostType","localAddress","openUrlInSimulatorSafeAsync","msg","stopWaitingForCommand","lanAddress","getAsync","defaultRecipient","rl","createInterface","input","stdin","output","stdout","handleKeypress","chr","name","cleanup","cancel","close","removeListener","startWaitingForCommand","addListener","question","sendTo","trim","sent","sendAsync","setAsync","reset","startAsync","dev","validation","reactNativeVersionWarnings","developerTool","offline","args","argv","slice","boolean","default","interactive","options","setRawMode","resume","setEncoding","on","isInteractive","run","onReady","green","dim","devMode","iosInfo"],"mappings":"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","file":"start.js","sourcesContent":["// @flow\n\nimport { Android, Config, Project, ProjectSettings, Simulator, UrlUtils, UserSettings } from 'xdl';\n\nimport chalk from 'chalk';\nimport indent from 'indent-string';\nimport qr from 'qrcode-terminal';\nimport minimist from 'minimist';\nimport readline from 'readline';\nimport { Exp } from 'xdl';\n\nimport clearConsole from '../util/clearConsole';\nimport log from '../util/log';\nimport packager from '../util/packager';\n\nConfig.validation.reactNativeVersionWarnings = false;\nConfig.developerTool = 'crna';\nConfig.offline = true;\n\nconst args = minimist(process.argv.slice(2), {\n  boolean: ['reset-cache', 'interactive'],\n  default: { interactive: true },\n});\nlet dev = true;\n\nconst options = {};\nif (args['reset-cache']) {\n  options.reset = true;\n  log('Asking packager to reset its cache...');\n}\n\nconst { stdin } = process;\nconst startWaitingForCommand = () => {\n  stdin.setRawMode(true);\n  stdin.resume();\n  stdin.setEncoding('utf8');\n  stdin.on('data', handleKeypress);\n};\n\nconst stopWaitingForCommand = () => {\n  stdin.removeListener('data', handleKeypress);\n  stdin.setRawMode(false);\n  stdin.resume();\n};\n\nlet isInteractive = false;\nif (args.interactive && typeof stdin.setRawMode === 'function') {\n  startWaitingForCommand();\n  isInteractive = true;\n}\n\npackager.run(onReady, options, isInteractive);\n\nfunction onReady() {\n  log(chalk.green('Packager started!\\n'));\n  printServerInfo();\n}\n\n// print a nicely formatted message with setup information\nasync function printServerInfo() {\n  const settings = await ProjectSettings.readPackagerInfoAsync(process.cwd());\n  // who knows why qrcode-terminal takes a callback instead of just returning a string\n  const address = await UrlUtils.constructManifestUrlAsync(process.cwd());\n  let emulatorHelp;\n  if (process.platform === 'darwin') {\n    emulatorHelp = `Press ${chalk.bold('a')} (Android) or ${chalk.bold('i')} (iOS) to start an emulator.`;\n  } else {\n    emulatorHelp = `Press ${chalk.bold('a')} to start an Android emulator.`;\n  }\n  qr.generate(address, qrCode => {\n    log(`\n${indent(qrCode, 2)}\n\nYour app is now running at URL: ${chalk.underline(chalk.cyan(address))}\n\n${chalk.bold('View your app with live reloading:')}\n\n  ${chalk.underline('Android device:')}\n    -> Point the Expo app to the QR code above.\n       (You'll find the QR scanner on the Projects tab of the app.)\n  ${chalk.underline('iOS device:')}\n    -> Press ${chalk.bold('s')} to email/text the app URL to your phone.\n  ${chalk.underline('Emulator:')}\n    -> ${emulatorHelp}\n\nYour phone will need to be on the same local network as this computer.\nFor links to install the Expo app, please visit ${chalk.underline(chalk.cyan('https://expo.io'))}.\n\nLogs from serving your app will appear here. Press Ctrl+C at any time to stop.`\n    );\n    printUsage();\n  });\n}\n\nfunction printUsage() {\n  if (!isInteractive) {\n    return;\n  }\n  const { dim, bold } = chalk;\n  const devMode = dev ? 'development' : 'production';\n  const iosInfo = process.platform === 'darwin'\n    ? `${dim(`, or`)} i ${dim(`to open iOS emulator.`)}`\n    : dim('.');\n  log(\n    `\n ${dim(`\\u203A Press`)} a ${dim(`to open Android device or emulator`)}${iosInfo}\n ${dim(`\\u203A Press`)} s ${dim(`to send the app URL to your phone number or email address`)}\n ${dim(`\\u203A Press`)} q ${dim(`to display QR code.`)}\n ${dim(`\\u203A Press`)} r ${dim(`to restart packager, or`)} R ${dim(`to restart packager and clear cache.`)}\n ${dim(`\\u203A Press`)} d ${dim(`to toggle development mode. (current mode: ${bold(devMode)}${chalk.reset.dim(')')}`)}\n`\n  );\n}\n\nconst CTRL_C = '\\u0003';\nconst CTRL_D = '\\u0004';\n\nasync function handleKeypress(key) {\n  switch (key) {\n    case CTRL_C:\n    case CTRL_D:\n      process.emit('SIGINT');\n      return;\n    case 'a': {\n      clearConsole();\n      log.withTimestamp('Starting Android...');\n      const { success, error } = await Android.openProjectAsync(process.cwd());\n      if (!success) {\n        log(chalk.red(error.message));\n      }\n      printUsage();\n      return;\n    }\n    case 'i': {\n      clearConsole();\n      log.withTimestamp('Starting iOS...');\n      const localAddress = await UrlUtils.constructManifestUrlAsync(process.cwd(), {\n        hostType: 'localhost',\n      });\n      const { success, msg } = await Simulator.openUrlInSimulatorSafeAsync(localAddress);\n      if (!success) {\n        log(chalk.red(msg));\n      }\n      printUsage();\n      return;\n    }\n    case 's': {\n      stopWaitingForCommand();\n      const lanAddress = await UrlUtils.constructManifestUrlAsync(process.cwd(), {\n        hostType: 'lan',\n      });\n      const defaultRecipient = await UserSettings.getAsync('sendTo', null);\n      const rl = readline.createInterface({\n        input: process.stdin,\n        output: process.stdout,\n      });\n      const handleKeypress = (chr, key) => {\n        if (key && key.name === 'escape') {\n          cleanup();\n          cancel();\n        }\n      };\n      const cleanup = () => {\n        rl.close();\n        process.stdin.removeListener('keypress', handleKeypress);\n        startWaitingForCommand();\n      };\n      const cancel = () => {\n        clearConsole();\n        printUsage();\n      };\n      clearConsole();\n      process.stdin.addListener('keypress', handleKeypress);\n      log('Please enter your phone number or email address (press ESC to cancel) ');\n      rl.question(defaultRecipient ? `[default: ${defaultRecipient}]> ` : '> ', async sendTo => {\n        cleanup();\n        if (!sendTo && defaultRecipient) {\n          sendTo = defaultRecipient;\n        }\n        sendTo = sendTo && sendTo.trim();\n        if (!sendTo) {\n          cancel();\n          return;\n        }\n        log.withTimestamp(`Sending ${lanAddress} to ${sendTo}...`);\n\n        let sent = false;\n        try {\n          await Exp.sendAsync(sendTo, lanAddress, true);\n          log.withTimestamp(`Sent link successfully.`);\n          sent = true;\n        } catch (err) {\n          log.withTimestamp(`Could not send link. ${err}`);\n        }\n        printUsage();\n        if (sent) {\n          await UserSettings.setAsync('sendTo', sendTo);\n        }\n      });\n      return;\n    }\n    case 'q':\n      clearConsole();\n      await printServerInfo();\n      return;\n    case 'r':\n    case 'R': {\n      clearConsole();\n      const reset = key === 'R';\n      if (reset) {\n        log.withTimestamp('Asking packager to reset its cache...');\n      }\n      log.withTimestamp('Restarting packager...');\n      Project.startAsync(process.cwd(), { reset });\n      return;\n    }\n    case 'd':\n      clearConsole();\n      dev = !dev;\n      await ProjectSettings.setAsync(process.cwd(), { dev });\n      log(\n        `Packager now running in ${chalk.bold(dev ? 'development' : 'production')}${chalk.reset(` mode.`)}\n\nPlease close and reopen the project in the Expo app for the\nchange to take effect.`\n      );\n      printUsage();\n      return;\n  }\n}\n"]}